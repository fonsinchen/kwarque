"use strict";

var express = require("express");
var app = express.createServer();

console.log(__dirname + "/../public/index.html");


app.configure(function () {
    app.set('view options', {layout: false});
    app.use(express.methodOverride());
    app.use(express.bodyParser());
    app.use(express["static"](__dirname + '/../public'));
    app.use(express.errorHandler({
        dumpExceptions: true,
        showStack: true
    }));
    app.use(app.router);
    app.register('.html', {
        compile: function(str) {
            return function() {return str;};
        }
    });
});

app.get("/", function (req, res) {
    res.render(__dirname + "/../public/index.html");
});


var handlers = {};
module.exports = {
    create : function (obj) {
        var F = function() {};
        F.prototype = obj;
        return new F();
    },
    
    on : function (event, callback) {
        if (handlers[event]) {
            handlers[event].push(callback);
        } else {
            handlers[event] = [callback];
        }
    },

    un : function (event, callback) {
        $.each(handlers[event], function (i, handler) {
            if (callback === handler) {
                handlers.splice(i, 1);
                return false;
            } else {
                return true;
            }
        });
    },

    emit : function (event, data) {
        if (typeof handlers[event] === 'object') {
            var eventHandlers = handlers[event];
            for (var i = 0; i < eventHandlers.length; ++i) {
                eventHandlers[i](data);
            }
        }
    },
    
    app : app
};